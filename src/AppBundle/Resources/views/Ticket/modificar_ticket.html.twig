{% extends 'base.html.twig' %}

{% block titulo %}Informacion de Ticket{% endblock %}
{% block menu_ticket %}class="active"{% endblock %}

{% block body %}
    <h1>Informacion de Ticket</h1>
    <div class="subheader">
        {% if ticket.estado == 'EN PROCESO' %}
            <a type="button" class="btn btn-success" onclick="cambiarEstado('COMPLETADO')">Ticket Completado</a>
        {% elseif ticket.estado == 'COMPLETADO' %}
            <span class="alert-success">Ticket Completado!</span>
        {% else %}
            <a type="button" class="btn btn-success" onclick="cambiarEstado('EN PROCESO')">Iniciar Ticket</a>
        {% endif %}
        <a type="button" class="btn btn-primary" href="{{ path('lista_tickets') }}">Volver</a>
    </div>
    <br />
    <div class="panel-heading full-width left">
        <div class="panel-body left">
            <h5>Asignación: #{{ ticket.id }}</h5>
        </div>
        <div class="panel-body left">
            <h5>Fecha Creado: {{ ticket.fechaCreado|date("m/d/Y") }}</h5>
        </div>
        <div class="panel-body left">
            <h5>Fecha Cerrado: {{ ticket.fechaCompletado|date("m/d/Y") }}</h5>
        </div>
        <div class="panel-body left">
            <h5>Estado: {{ ticket.estado }}</h5>
        </div>
        <br />
        <div style="clear: both;"></div>
        <div class="center">
            <h4>Asignado A: {{ usuarioasigna }}</h4>
        </div>
    </div>
    <br />
    <div class="panel-primary">
        <div class="left">
            <h4>Solicitado Por: {{ usuariocrea }}</h4>
        </div>
        <br />
        <div class="left">
            <h4>Descripcion:</h4> <p>{{ ticket.descripcion }}</p>
        </div>

    </div>
    <input type="hidden" value="{{ ticket.id }}" id="id">
    <script>
        function cambiarEstado(nuevoEstado) {

            var id = $('#id').val();
//            var data = nuevoEstado;
//            console.log(data);
            $.ajax({
                url: '/app_dev.php/rest/ticket/' + id+'/cambia',
                type: 'PUT',
                data : nuevoEstado,
                success: function (response) {
//                    console.log(response);
                    window.location = '/app_dev.php/tickets';
                }                ,
                error: function (err) {
                    console.log(err);
//                    alert("que te creias papá")
                }
            });
        }
    </script>
{% endblock %}